<div class="filter-toolbar d-flex justify-content-between align-items-center flex-wrap">
  <!-- Left: Search input -->
  <div class="quick-search-wrapper">
    <div class="input-container">
      <input
        type="text"
        [(ngModel)]="searchInputText"
        (input)="onSearchInputText(searchInputText)"
        placeholder="Search"
        class="responsive-search-input"
      />
      <button
        *ngIf="searchInputText"
        class="clear-btn2"
        (click)="clearSearch()"
        aria-label="Clear"
      >
        ×
      </button>
    </div>
  </div>
  <!-- Right: Placeholder for additional elements -->
  <!-- <div class="additional-filters"></div> -->
<!-- </div> -->
  <!-- Right: Placeholder for additional elements -->
  <!-- <div class="additional-filters"></div> -->
<!-- </div> -->
  

  <!-- Right: Year buttons -->
  <div class="year-filters d-flex flex-wrap gap-2">
    <div class="year-filter-buttons m custom-tab-label" *ngFor="let year of years">
      <button
        [ngClass]="{ 'active': selectedYear === year }"
        (click)="selectYear(year)">
        {{ year === '' ? 'All' : year }}
      </button>
    </div>
  </div>
</div>


<mat-sidenav-container class="drawer-container">
  <mat-sidenav #drawer mode="side" opened>
    <mat-accordion style="height: 100vh">
      <span style="
          display: flex;
          flex-direction: row;
          justify-content: flex-start;
          align-items: center;
          padding-left: 10px;
          width: 30%;
        ">
        <button style="margin-right: 5px" mat-icon-button *ngIf="!menuIcon" (click)="drawer.toggle(); toggleIcon()">
          <span class="material-symbols-outlined">left_panel_close</span>
        </button>
        <span style="display: flex; align-items: center; gap: 8px; font-size: 16px;">
          <h4 style="font-size: 16px; font-weight: bolder; white-space: nowrap; font-family: 'Tenorite','sans-serif';">All Filters</h4>

        </span>
      </span>
      <br />

      <!-- Litigation Venues & Judicial Authorities -->
      <div class="panel-wrapper">
      <mat-expansion-panel #litigationPanel="matExpansionPanel" >
        <mat-expansion-panel-header>
          <mat-panel-title class="carde"
          [ngClass]="{ 'active-title': litigationPanel.expanded }"
          style="line-height: 20px; font-size: 14px; font-weight: bolder; font-family: 'Tenorite',sans-serif;">
            Litigation Venues & <br />
            Judicial Authorities
          </mat-panel-title>
        </mat-expansion-panel-header>
        <section style="display: flex; flex-wrap: wrap" *ngIf="litigationVenueOptions.length > 0">
          <mat-checkbox [checked]="selectedSources.has(item)" *ngFor="let item of litigationVenueOptions"
            (change)="onCheckboxLitigationVenueChange($event.checked, item)">
            {{ item }}
          </mat-checkbox>
        </section>
        <div style="
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: flex-start;
            gap: 5px;
          " *ngIf="isLoadingFilters">
          <mat-spinner color="accent" diameter="15"></mat-spinner>
          <span style="font-size: 14px">fetching latest venues..</span>
        </div>
        <!-- <hr style="border: 2px solid black; margin: 10px 0;"> Line added here -->
      </mat-expansion-panel>
      </div>

      <!-- Case Status -->
      <div class="panel-wrapper">
      <mat-expansion-panel #casePanel="matExpansionPanel">
        <mat-expansion-panel-header>
          <mat-panel-title class="carde" [ngClass]="{ 'active-title': casePanel.expanded }" style="font-size: 14px; font-weight: bolder;"> Case Status </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="scrollable-radio-group">
          <mat-radio-group aria-label="Select an option" [(ngModel)]="selectedCaseStatus"
            (change)="onCaseStatusChange()">
            <mat-radio-button value="All">All</mat-radio-button>
            <ng-container *ngFor="let item of caseStatusOptions">
              <mat-radio-button [value]="item">{{ item }}</mat-radio-button>
            </ng-container>
          </mat-radio-group>
        </div>
      </mat-expansion-panel>
      </div>

      <!-- Case Number -->
      <div class="panel-wrapper">
      <mat-expansion-panel #casenumberPanel="matExpansionPanel">
        <mat-expansion-panel-header>
          <mat-panel-title class="carde" [ngClass]="{ 'active-title': casenumberPanel.expanded }"  style="font-size: 14px; font-weight: bolder;"> Case Number </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-form-field appearance="outline" style="width: 100%">
          <mat-label></mat-label>
          <mat-chip *ngFor="let no of selectedCaseNumbers" (removed)="removeCaseNo(no)">
            {{ no }}
            <mat-icon matChipRemove >cancel</mat-icon>
          </mat-chip>
          <input matInput [(ngModel)]="caseNumberInputValue"
            [matAutocomplete]="autoSearchCaseNumber" [disabled]="isLoadingFilters"  (input)="onSearchCaseNumberInput(caseNumberInputValue)" />
            <button *ngIf="caseNumberInputValue" matSuffix mat-icon-button aria-label="Clear" (click)="clearSearchCaseNumber()">
              <mat-icon>close</mat-icon>
            </button>
          <mat-autocomplete #autoSearchCaseNumber="matAutocomplete"
            (optionSelected)="selectCaseNumber($event.option.value)">
            <mat-option *ngFor="let caseNumber of filteredCaseNumbers" [value]="caseNumber">
              {{ caseNumber }}
            </mat-option>
            <mat-option *ngIf="filteredCaseNumbers.length === 0 && caseNumberInputValue" disabled>
              No results found
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </mat-expansion-panel>
      </div>


      <!-- Case History -->
       <!-- kjsdvnckjs -->

       <!-- fkvnklf -->
      <div class="panel-wrapper">
      <mat-expansion-panel #casehistoryPanel="matExpansionPanel">
        <mat-expansion-panel-header>
          <mat-panel-title class="carde" [ngClass]="{ 'active-title': casehistoryPanel.expanded }"  style="font-size: 14px; font-weight: bolder;"> Case History </mat-panel-title>
        </mat-expansion-panel-header>
        <label class="example-value-label" style="color: rgb(10, 9, 9)">In last {{ slider.value }} years</label>
        <mat-slider [max]="max" [disabled]="!max" [min]="min" [step]="step" [discrete]="thumbLabel"
          [showTickMarks]="showTicks" style="width: 100%">
          <input matSliderThumb [(ngModel)]="valueSlider" #slider (input)="onYearSliderChange(valueSlider)" />
        </mat-slider>
      </mat-expansion-panel>
      </div>

      <!-- Case Filed Date -->
      <div class="panel-wrapper">
      <mat-expansion-panel #casefilePanel="matExpansionPanel">
        <mat-expansion-panel-header>
          <mat-panel-title class="carde" [ngClass]="{ 'active-title': casefilePanel.expanded }"  style="font-size: 14px; font-weight: bolder;">Case Filed Date</mat-panel-title>
        </mat-expansion-panel-header>
        <mat-form-field appearance="outline">
          <mat-label>Enter a date range</mat-label>
          <mat-date-range-input [rangePicker]="filedDatePicker" #filedDateRangeInput>
            <input matStartDate placeholder="Start date" [formControl]="dateControl" />
            <input matEndDate placeholder="End date" (dateChange)="getAllCaseFilledDate(filedDateRangeInput)"
              [formControl]="dateControl" />
          </mat-date-range-input>
          <mat-datepicker-toggle matIconSuffix [for]="filedDatePicker"></mat-datepicker-toggle>
          <mat-date-range-picker #filedDatePicker></mat-date-range-picker>
        </mat-form-field>
      </mat-expansion-panel>
      </div>

      <!-- Case Close Date -->
      <div class="panel-wrapper">
      <mat-expansion-panel #caseclosePanel="matExpansionPanel">
        <mat-expansion-panel-header>
          <mat-panel-title class="carde" [ngClass]="{ 'active-title': caseclosePanel.expanded }" style="font-size: 14px; font-weight: bolder;">Case Close Date</mat-panel-title>
        </mat-expansion-panel-header>
        <mat-form-field appearance="outline">
          <mat-label>Enter a date range</mat-label>
          <mat-date-range-input [rangePicker]="closedDatePicker" #closedDateRangeInput>
            <input matStartDate placeholder="Start date" [formControl]="dateControlClose" />
            <input matEndDate placeholder="End date" (dateChange)="getAllCaseClosedDate(closedDateRangeInput)"
              [formControl]="dateControlClose" />
          </mat-date-range-input>
          <mat-datepicker-toggle matIconSuffix [for]="closedDatePicker"></mat-datepicker-toggle>
          <mat-date-range-picker #closedDatePicker></mat-date-range-picker>
        </mat-form-field>
      </mat-expansion-panel>
      </div>

      <!-- Plaintiff -->
      <div class="panel-wrapper">
      <mat-expansion-panel #plaintiffPanel="matExpansionPanel">
        <mat-expansion-panel-header>
          <mat-panel-title class="carde" [ngClass]="{ 'active-title': plaintiffPanel.expanded }"
          style="font-size: 14px; font-weight: bolder;"> Plaintiff </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-form-field appearance="outline" style="width: 100%;">
          <mat-label>Search</mat-label>
        
          <input
          
            matInput
            [(ngModel)]="plaintiffInputValue"
            [matAutocomplete]="autoSearchPlaintiff"
            (input)="onSearchPlaintiffInput(plaintiffInputValue)" 
            />

            <button
    *ngIf="plaintiffInputValue"
    matSuffix
    mat-icon-button
    aria-label="Clear"
    (click)="clearPlaintiffSearch()"
    style="overflow:hidden; z-index:1000 !important"
    >
    <mat-icon style="overflow:hidden; z-index:1000 !important">close</mat-icon>
  </button>
        
          <mat-autocomplete #autoSearchPlaintiff="matAutocomplete"
            (optionSelected)="selectPlaintiff($event.option.value)">
            <mat-option *ngFor="let plaintiff of filteredPlaintiff" [value]="plaintiff">
              {{ plaintiff }}
            </mat-option>
            <mat-option *ngIf="filteredPlaintiff.length === 0 && plaintiffInputValue" disabled>
              No results found
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
        
        <!-- ✅ Chips shown below or above form-field -->
        <div class="chip-wrapper">
          <mat-chip *ngFor="let plaintiff of selectedPlaintiff" [removable]="true"
            (removed)="removePlaintiff(plaintiff)">
            {{ plaintiff }}
            <mat-icon matChipRemove style="z-index:1000 !important; text-overflow: hidden; overflow: hidden;">cancel</mat-icon>
          </mat-chip>
        </div>
        
        

        
      </mat-expansion-panel>
      </div>

      <!-- Defendant -->
<!-- Defendant -->
<div class="panel-wrapper">
  <mat-expansion-panel #defendantPanel="matExpansionPanel">
    <mat-expansion-panel-header>
      <mat-panel-title
        class="carde"
        [ngClass]="{ 'active-title': defendantPanel.expanded }"
        style="font-size: 14px; font-weight: bolder;"
      >
        Defendant
      </mat-panel-title>
    </mat-expansion-panel-header>

    <!-- ✅ Input Field -->
    <mat-form-field appearance="outline" style="width: 100%">
      <mat-label>Search</mat-label>

      <input
        matInput
        [(ngModel)]="defendantInputValue"
        [matAutocomplete]="autoSearchDefendant"
        (input)="onSearchDefendantInput(defendantInputValue)"
      />

      <!-- ✅ Optional Clear Button -->
      <button
        *ngIf="defendantInputValue"
        matSuffix
        mat-icon-button
        aria-label="Clear"
        (click)="clearDefendantSearch()"
      >
        <mat-icon>close</mat-icon>
      </button>

      <mat-autocomplete
        #autoSearchDefendant="matAutocomplete"
        (optionSelected)="selectDefendant($event.option.value)"
      >
        <mat-option
          *ngFor="let defendant of filteredDefendants"
          [value]="defendant"
        >
          {{ defendant }}
        </mat-option>
        <mat-option
          *ngIf="filteredDefendants.length === 0 && defendantInputValue"
          disabled
        >
          No results found
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <!-- ✅ Chips Outside Input -->
    <div class="chip-wrapper">
      <mat-chip
        *ngFor="let defendant of selectedDefendant"
        [removable]="true"
        (removed)="removeDefandant(defendant)"
        [matTooltip]="defendant"
      >
        {{ defendant }}
        <mat-icon matChipRemove style="z-index:1000 !important; text-overflow: ellipsis; overflow: hidden;white-space: nowrap;">cancel</mat-icon>
      </mat-chip>
    </div>
  </mat-expansion-panel>
</div>

<div class="panel-wrapper">
  <mat-expansion-panel #industryPanel="matExpansionPanel">
    <mat-expansion-panel-header>
      <mat-panel-title class="carde" [ngClass]="{ 'active-title': industryPanel.expanded }" style="font-size: 14px; font-weight: bolder;">
        Industry
      </mat-panel-title>
    </mat-expansion-panel-header>
    <mat-form-field appearance="outline" style="width: 100%;">
      <mat-label>Search Industries</mat-label>
      <input
        matInput
        [(ngModel)]="industryInputValue"
        [matAutocomplete]="autoIndustry"
        (input)="filterIndustry()"
        placeholder="Search industries"
      />
      <!-- <button
        *ngIf="industryInputValue"
        matSuffix
        mat-icon-button
        aria-label="Clear"
        (click)="clearIndustrySearch()"
      >
        <mat-icon>close</mat-icon>
      </button> -->
      <mat-autocomplete #autoIndustry="matAutocomplete" (optionSelected)="selectIndustry($event.option.value)">
        <mat-option *ngFor="let industry of filteredIndustry" [value]="industry">
          {{ industry }}
        </mat-option>
        <mat-option *ngIf="filteredIndustry.length === 0 && industryInputValue" disabled>
          No results found
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>
    <!-- Chips displayed below input -->
    <div class="chip-wrapper">
      <mat-chip *ngFor="let industry of selectedIndustry" [removable]="true" (removed)="removeIndustry(industry)">
        {{ industry }}
        <mat-icon matChipRemove>cancel</mat-icon>
      </mat-chip>
    </div>
    <!-- Optional checkbox list (if still needed) -->
    <section class="example-section" *ngIf="showCheckboxes">
      <mat-checkbox [checked]="selectedIndustry.has(industry)" (change)="onCheckboxIndustryChange($event.checked, industry)"
        *ngFor="let industry of filteredIndustry">
        {{ industry }}
      </mat-checkbox>
    </section>
  </mat-expansion-panel>
</div>

<!-- Tech Category -->
<div class="panel-wrapper">
  <mat-expansion-panel #techcategoryPanel="matExpansionPanel">
    <mat-expansion-panel-header>
      <mat-panel-title
        class="carde"
        [ngClass]="{ 'active-title': techcategoryPanel.expanded }"
        style="font-size: 14px; font-weight: bolder;"
      >
        Tech Category
      </mat-panel-title>
    </mat-expansion-panel-header>

    <!-- ✅ Input Field -->
    <mat-form-field appearance="outline" style="width: 100%;">
      <mat-label>Search</mat-label>

      <input
      style="overflow:hidden;text-overflow: ellipsis;
  white-space: nowrap;"
        type="text"
        matInput
        [(ngModel)]="techCategoryInputValue"
        (input)="filterTechCategory()"
        placeholder="Search tech categories"
      />

      <!-- ✅ Clear button -->
      <button
      style="z-index:1000 !important;"
        *ngIf="techCategoryInputValue"
        matSuffix
        mat-icon-button
        aria-label="Clear"
        (click)="clearTechCategoryFilter()"
      >
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>

    <!-- ✅ Chips displayed outside the input -->
    <div class="chip-wrapper">
      <mat-chip
        *ngFor="let category of selectedTechCategory"
        [removable]="true"
        (removed)="removeCategory(category)"
        [matTooltip]="category"
        style="overflow:hidden;text-overflow: ellipsis;
  white-space: nowrap;"
      >
        {{ category }}
        <mat-icon matChipRemove style="overflow:hidden;text-overflow: ellipsis;
  white-space: nowrap;z-index:1000 !important;">cancel</mat-icon>
      </mat-chip>
    </div>

    <!-- ✅ Checkbox list -->
    <section class="example-section scrollable-checkbox-list">
      <mat-checkbox
        *ngFor="let techCategory of filteredTechCategory"
        [checked]="selectedTechCategory.has(techCategory)"
        (change)="onCheckboxTechCategoryChange($event.checked, techCategory)"
      >
        {{ techCategory }}
      </mat-checkbox>

      <div *ngIf="filteredTechCategory.length === 0 && techCategoryInputValue" class="no-results">
        No results found
      </div>
    </section>
  </mat-expansion-panel>
</div>


<!-- Technology Keywords -->
<div class="panel-wrapper">
  <mat-expansion-panel #technologykeyPanel="matExpansionPanel">
    <mat-expansion-panel-header>
      <mat-panel-title
        class="carde"
        [ngClass]="{ 'active-title': technologykeyPanel.expanded }"
        style="font-size: 14px; font-weight: bolder;"
      >
        Technology Keywords
      </mat-panel-title>
    </mat-expansion-panel-header>

    <!-- ✅ Input Field -->
    <mat-form-field appearance="outline" style="width: 100%">
      <mat-label>Search</mat-label>

      <input
        matInput
        [(ngModel)]="technologyKeywordInputValue"
        
        (input)="filterTechnologyKeywords()"
        placeholder="Search Technology Keywords"
      />

      <!-- ✅ Clear Button -->
      <button
        *ngIf="technologyKeywordInputValue"
        matSuffix
        mat-icon-button
        aria-label="Clear"
        (click)="clearTechnologyKeywords()"
      >
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>

    <!-- ✅ Chips shown outside input -->
    <div class="chip-wrapper">
      <mat-chip
        *ngFor="let keyword of selectedTechnologyKeywords"
        [removable]="true"
        (removed)="removeKeyword(keyword)"
        [matTooltip]="keyword"
      >
        {{ keyword }}
        <mat-icon matChipRemove style="z-index:1000 !important; text-overflow: ellipsis; overflow: hidden;">cancel</mat-icon>
      </mat-chip>
    </div>

    <!-- ✅ Checkbox List -->
    <div class="example-section scrollable-checkbox-list">
      <mat-checkbox
        *ngFor="let keyword of filteredTechnologyKeywords"
        [checked]="selectedTechnologyKeywords.has(keyword)"
        (change)="onTechnologyKeywordChanged(keyword, $event.checked)"
      >
        {{ keyword }}
      </mat-checkbox>

      <div
        *ngIf="filteredTechnologyKeywords.length === 0 && technologyKeywordInputValue"
        class="no-results"
      >
        No results found
      </div>
    </div>
  </mat-expansion-panel>
</div>


<!-- Court Name -->
<div class="panel-wrapper">
  <mat-expansion-panel #courtnamePanel="matExpansionPanel">
    <mat-expansion-panel-header>
      <mat-panel-title
        class="wrap-text2"
        [ngClass]="{ 'active-title': courtnamePanel.expanded }"
        style="font-size: 14px; font-weight: bolder;"
      >
        Court Name
      </mat-panel-title>
    </mat-expansion-panel-header>

    <!-- ✅ Input Field -->
    <mat-form-field appearance="outline" style="width: 100%">
      <mat-label>Search</mat-label>

      <input
        matInput
        [(ngModel)]="courtNameInputValue"
        (focus)="onSearchCourtNamesInput(courtNameInputValue)"
        (input)="onSearchCourtNamesInput(courtNameInputValue)"
        placeholder="Type court name"
        style="overflow:hidden;text-overflow: ellipsis;
  white-space: nowrap;z-index:1000 !important;"
      />

      <!-- Optional Clear Button -->
      <button
        
        matSuffix
        mat-icon-button
        aria-label="Clear"
        (click)="clearCourtNamesSearch()"
        style="text-overflow: ellipsis; overflow: hidden;"
      >
        <mat-icon style="z-index:1000 !important; text-overflow: ellipsis; overflow: hidden;">close</mat-icon>
      </button>
    </mat-form-field>

    <!-- ✅ Chips Below Input -->
    <div class="chip-wrapper">
      <mat-chip
        *ngFor="let court of selectedCourtName"
        [removable]="true"
        (click)="clearCourtNamesSearch()"
        [matTooltip]="court"
        style="overflow:hidden;text-overflow: ellipsis;
  white-space: nowrap;z-index:1000 !important;"
      >
        {{ court }}
        <mat-icon (click)="clearCourtNamesSearch()"  matChipRemove style="z-index:1000 !important; text-overflow:ellipsis; overflow: hidden; white-space:nowrap">cancel</mat-icon>
      </mat-chip>
    </div>

    <!-- ✅ Checkbox Options -->
    <section class="example-section scrollable-checkbox-list">
      <mat-checkbox
        [checked]="selectedCourtName.has(courtName)"
        (change)="onCheckboxCourtNameChange($event.checked, courtName)"
        *ngFor="let courtName of filteredCourtName"
      >
        {{ courtName }}
      </mat-checkbox>

      <div *ngIf="filteredCourtName.length === 0 && courtNameInputValue" class="no-results">
        No results found
      </div>
    </section>
  </mat-expansion-panel>
</div>


      <!-- Acquisition Type -->
      <div class="panel-wrapper">
      <mat-expansion-panel #acquisitionPanel="matExpansionPanel">
        <mat-expansion-panel-header>
          <mat-panel-title class="carde" [ngClass]="{ 'active-title': acquisitionPanel.expanded }"  style="font-size: 14px; font-weight: bolder;"> Acquisition Type </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-radio-group aria-label="Select an option" (change)="onAcquisitionTypeChange($event.value, true)">
          <mat-radio-button value="">All</mat-radio-button>
          <ng-container *ngFor="let item of acquisition_types">
            <mat-radio-button [value]="item">{{ item }}</mat-radio-button>
          </ng-container>
        </mat-radio-group>
      </mat-expansion-panel>
      </div>

      <!-- Patent Type -->
      <div class="panel-wrapper">
      <mat-expansion-panel #patentPanel="matExpansionPanel">
        <mat-expansion-panel-header>
          <mat-panel-title class="carde" [ngClass]="{ 'active-title': patentPanel.expanded }" style="font-size: 14px; font-weight: bolder;"> Patent Type </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-radio-group aria-label="Select an option" [(ngModel)]="selectedPatentType" (change)="onPatentTypeChange()">
          <mat-radio-button value="All">All</mat-radio-button>
          <ng-container *ngFor="let item of patent_types">
            <mat-radio-button [value]="item">{{ item }}</mat-radio-button>
          </ng-container>
        </mat-radio-group>
      </mat-expansion-panel>
      </div>

<!-- Patent No. -->
<div class="panel-wrapper">
  <mat-expansion-panel #patentnumPanel="matExpansionPanel">
    <mat-expansion-panel-header>
      <mat-panel-title
        class="carde"
        [ngClass]="{ 'active-title': patentnumPanel.expanded }"
        style="font-size: 14px; font-weight: bolder;"
      >
        Patent No.
      </mat-panel-title>
    </mat-expansion-panel-header>

    <mat-form-field appearance="outline" style="width: 100%">
      <mat-label>Search</mat-label>

      <!-- Just the input here -->
      <input
        type="text"
        matInput
        [(ngModel)]="patentNoInputValue"
        [matAutocomplete]="autoSearchPatentNo"
        (input)="onSearchPatentNoInput(patentNoInputValue)"
        placeholder="e.g. 1104721, etc."
        style="overflow:hidden;white-space:nowrap;text-overflow:ellipsis"
      />

      <!-- Optional clear button -->
      <button
        *ngIf="patentNoInputValue"
        matSuffix
        mat-icon-button
        aria-label="Clear"
        (click)="clearPatentNoSearch()"
      >
        <mat-icon>close</mat-icon>
      </button>

      <mat-autocomplete
        #autoSearchPatentNo="matAutocomplete"
        (optionSelected)="selectPatentNo($event.option.value)"
      >
        <mat-option
          *ngFor="let patentNo of filteredPatentNos"
          [value]="patentNo"
        >
          {{ patentNo }}
        </mat-option>
        <mat-option
          *ngIf="filteredPatentNos.length === 0 && patentNoInputValue"
          disabled
        >
          No results found
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <!-- ✅ Chips shown below input with scroll -->
    <div class="chip-wrapper">
      <mat-chip
        *ngFor="let patentNo of selectedpatentNo"
        [removable]="true"
        (removed)="removePatentNo(patentNo)"
        [matTooltip]="patentNo"
      >
        {{ patentNo }}
        <mat-icon matChipRemove>cancel</mat-icon>
      </mat-chip>
    </div>
  </mat-expansion-panel>
</div>     


      <!-- Cause of Action -->
<!-- Cause of Action -->
<div class="panel-wrapper">
  <mat-expansion-panel #causeofactionPanel="matExpansionPanel">
    <mat-expansion-panel-header>
      <mat-panel-title
        class="carde"
        [ngClass]="{ 'active-title': causeofactionPanel.expanded }"
        style="font-size: 14px; font-weight: bolder;"
      >
        Cause of Action
      </mat-panel-title>
    </mat-expansion-panel-header>

    <mat-form-field appearance="outline" style="width: 100% ;">
      <mat-label>Search</mat-label>
      <input
        matInput
        [(ngModel)]="causeOfActionInputValue"
        [matAutocomplete]="autoSearchCauseOfAction"
        (input)="onSearchCauseOfActionInput(causeOfActionInputValue)"
        style="overflow:hidden"
      />
      <button
        *ngIf="causeOfActionInputValue"
        matSuffix
        mat-icon-button          
        aria-label="Clear"
        (click)="clearCauseOfActionSearch()"
        
      >
        <mat-icon>close</mat-icon>
      </button>
      <mat-autocomplete style="overflow:hidden"
        #autoSearchCauseOfAction="matAutocomplete"
        (optionSelected)="selectCauseOfAction($event.option.value)"
      >
        <mat-option *ngFor="let causeOfAction of filteredCauseOfActions" [value]="causeOfAction">
          {{ causeOfAction }}
        </mat-option>
        <mat-option *ngIf="filteredCauseOfActions.length === 0 && causeOfActionInputValue" disabled>
          No results found
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <!-- ✅ Chips with mat-chip-list for better overflow control -->
    <div class="chip-wrapper">
      <!-- <mat-chip-list> -->
        <mat-chip
          *ngFor="let action of selectedCauseOfAction"
          [removable]="true"
          (removed)="removeactions(action)"
          [matTooltip]="action"
          style="overflow:hidden"
        >
          {{ action }}
          <mat-icon matChipRemove style="z-index:1000 !important; text-overflow: ellipsis; overflow: hidden;">cancel</mat-icon>
        </mat-chip>
      <!-- </mat-chip-list> -->
    </div>
  </mat-expansion-panel>
</div>


      <!-- Standard Essential Patent -->
      <div class="panel-wrapper">
      <mat-expansion-panel  #standardessentialPanel="matExpansionPanel">
        <mat-expansion-panel-header>
          <mat-panel-title class="carde" [ngClass]="{ 'active-title': standardessentialPanel.expanded }" style="font-size: 14px; font-weight: bolder;">Standard Essential Patent</mat-panel-title>
        </mat-expansion-panel-header>
        <mat-radio-group aria-label="Select an option" [(ngModel)]="selectedStandardPatent" (change)="onStandardPatentChange()">
          <mat-radio-button value="All">All</mat-radio-button>
          <ng-container *ngFor="let item of standardEssentialPatentArrays">
            <mat-radio-button [value]="item">{{ item }}</mat-radio-button>
          </ng-container>
        </mat-radio-group>
      </mat-expansion-panel>
      </div>

      <!-- Semiconductor Patent -->
      <div class="panel-wrapper">
      <mat-expansion-panel #semiconductorpatentPanel="matExpansionPanel">
        <mat-expansion-panel-header>
          <mat-panel-title class="carde" [ngClass]="{ 'active-title': semiconductorpatentPanel.expanded }" style="font-size: 14px; font-weight: bolder;">Semiconductor Patent</mat-panel-title>
        </mat-expansion-panel-header>
        <mat-radio-group aria-label="Select an option" [(ngModel)]="selectedSemiconductorpatent" (change)="onSemiconductorPatentChange()">
          <mat-radio-button value="All">All</mat-radio-button>
          <ng-container *ngFor="let item of semiconductorPatentArrays">
            <mat-radio-button [value]="item">{{ item }}</mat-radio-button>
          </ng-container>
        </mat-radio-group>
      </mat-expansion-panel>
      </div>
    </mat-accordion>
  </mat-sidenav>

  <mat-sidenav-content class="abc" style="height: auto; background-color: var(--content-bg); margin: 0; padding: 0; overflow: visible;">
    <div class="sticky-header">
      <!-- Year Filter Buttons -->

    </div>

    <div class="filter-chips-container" style="
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: flex-start;
        padding-top: 5px;
      ">
      <button *ngIf="menuIcon" style="margin-left: 10px" mat-icon-button (click)="toggleIcon(); drawer.toggle()">
        <mat-icon>menu</mat-icon>
      </button>
      <div style="
          display: flex;
          flex-direction: row;
          align-items: center;
          justify-content: flex-start;
        ">
        <p style="margin: 0; margin-left: 5px">
          <!-- Case Status Chip -->
          <mat-chip *ngIf="selectedCaseStatus !== ''" (removed)="removeFilter('status')">
            Case Status: {{ selectedCaseStatus }}
            <button matChipRemove [attr.aria-label]="'remove case status'">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>

          <!-- Litigation Venues & Judicial Authorities Chip -->
          <mat-chip *ngFor="let source of selectedSources" (removed)="removeFilter('litigationVenues', source)">
            Litigation Venue: {{ source }}
            <button matChipRemove [attr.aria-label]="'remove litigation venue'">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>

          <!-- Case History Chip (Year Slider) -->
          <mat-chip *ngIf="yearValueSelected !== undefined" (removed)="removeFilter('caseHistory')">
            Case History: Last {{ yearValueSelected }} years
            <button matChipRemove [attr.aria-label]="'remove case history'">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>

          <!-- Case Filled Date Range Chip -->
          <mat-chip *ngIf="selectedFilledStartDate && selectedFilledEndDate" (removed)="removeFilter('caseFilledDate')">
            Case Filled Date: {{ selectedFilledStartDate | date }} - {{ selectedFilledEndDate | date }}
            <button matChipRemove [attr.aria-label]="'remove case filled date'">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>

          <!-- Case Close Date Range Chip -->
          <mat-chip *ngIf="selectedClosedStartDate && selectedClosedEndDate" (removed)="removeFilter('caseClosedDate')">
            Case Close Date: {{ selectedClosedStartDate | date }} - {{ selectedClosedEndDate | date }}
            <button matChipRemove [attr.aria-label]="'remove case Close date'">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>

          <!-- Case Number Chip -->
          <mat-chip style="overflow:hidden;text-overflow:ellipsis;white-space: nowrap;" *ngFor="let caseNumber of selectedCaseNumbers" (removed)="removeFilter('caseNumber', caseNumber)">
            Case Number: {{ caseNumber }}
            <button matChipRemove [attr.aria-label]="'remove caseNumber'">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>

          <!-- Plaintiff Chip -->
          <mat-chip *ngFor="let plaintiffOrPetitioner of selectedPlaintiff" (removed)="removeFilter('plaintiffOrPetitioner', plaintiffOrPetitioner)">
            Plaintiff: {{ plaintiffOrPetitioner }}
            <button matChipRemove [attr.aria-label]="'remove plaintiffOrPetitioner'">
              <mat-icon style="z-index:1000 !important; text-overflow: ellipsis; overflow: hidden;">cancel</mat-icon>
            </button>
          </mat-chip>

          <!-- Case Defendant Chip -->
          <mat-chip *ngFor="let defendant of selectedDefendant" (removed)="removeFilter('defendant', defendant)">
            Defendant: {{ defendant }}
            <button matChipRemove [attr.aria-label]="'remove defendant'">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>

          <!-- Case Industry Chip -->
          <mat-chip *ngFor="let industry of selectedIndustry" (removed)="removeFilter('industry', industry)">
            Industry: {{ industry }}
            <button matChipRemove [attr.aria-label]="'remove industry'">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>

          <!-- Tech Category Chip -->
          <mat-chip style="overflow:hidden;text-overflow: ellipsis;
  white-space: nowrap;" *ngFor="let techCategory of selectedTechCategory" (removed)="removeFilter('techCategory', techCategory)">
            Tech Category: {{ techCategory }}
            <button style="overflow:hidden;text-overflow: ellipsis;
  white-space: nowrap;" matChipRemove [attr.aria-label]="'remove techCategory'" >
              <mat-icon style="overflow:hidden;text-overflow: ellipsis;
  white-space: nowrap;">cancel</mat-icon>
            </button>
          </mat-chip>

          <!-- Technology Keywords Chip  tableupper-->
          <mat-chip *ngFor="let technologyKeywords of selectedTechnologyKeywords" (removed)="removeFilter('technologyKeywords', technologyKeywords)">
            Technology Keywords: {{ technologyKeywords }}
            <button matChipRemove [attr.aria-label]="'remove technologyKeywords'">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>

          <!-- Court Names Chip -->
          <mat-chip *ngFor="let courtNames of selectedCourtName" (removed)="removeFilter('courtNames', courtNames)">
            CourtNames: {{ courtNames }}
            <button style="z-index:1000 !important" matChipRemove [attr.aria-label]="'remove courtNames'">
              <mat-icon style="z-index:1000 !important">cancel</mat-icon>
            </button>
          </mat-chip>

          <!-- Acquisition Type Chip -->
          <mat-chip *ngIf="selectedAcquisitionType !== ''" (removed)="removeFilter('acquiredPatentOrOrganicPatent')">
            Acquisition Type: {{ selectedAcquisitionType }}
            <button matChipRemove [attr.aria-label]="'remove acquiredPatentOrOrganicPatent'">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>

          <!-- Patent Type Chip -->
          <mat-chip *ngIf="selectedPatentType !== ''" (removed)="removeFilter('typeOfPatent')">
            Patent Type: {{ selectedPatentType }}
            <button matChipRemove [attr.aria-label]="'remove typeOfPatent'">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>

          <!-- Patent No Chip -->
          <mat-chip *ngFor="let patentNo of selectedpatentNo" (removed)="removeFilter('patentNo', patentNo)">
            Patent No: {{ patentNo }}
            <button matChipRemove [attr.aria-label]="'remove patentNo'">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>

          <!-- Cause of Action Chip -->
          <!-- <mat-chip *ngFor="let causeOfAction of selectedCauseOfAction" (removed)="removeFilter('causeOfAction', causeOfAction)">
            Cause Of Action: {{ causeOfAction }}
            <button matChipRemove [attr.aria-label]="'remove causeOfAction'">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip> -->


            <!-- Only show if there's at least one selected item -->
<!-- ✅ Only show chip box if there are selected items -->



<div class="chip-wrapper" *ngIf="selectedCauseOfActionArray.length > 0">
  <mat-chip
    *ngFor="let action of selectedCauseOfActionArray"
    [removable]="true"
    (removed)="removeactions(action)"
    [matTooltip]="action"
  >
    <span class="chip-text">{{ action }}</span>
    <mat-icon matChipRemove>cancel</mat-icon>
  </mat-chip>
</div>




        


          <!-- Standard Essential Patent Chip -->
          <mat-chip *ngFor="let standardEssentialPatent of selectedStandardEssentialPatent" (removed)="removeFilter('standardEssentialPatent', standardEssentialPatent)">
            Standard Essential Patent: {{ standardEssentialPatent }}
            <button matChipRemove [attr.aria-label]="'remove standardEssentialPatent'">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>

          <!-- Semiconductor Patent Chip -->
          <mat-chip *ngFor="let semiconductorPatent of selectedSemiconductorPatent" (removed)="removeFilter('semiconductorPatent', semiconductorPatent)">
            Standard Essential Patent: {{ semiconductorPatent }}
            <button matChipRemove [attr.aria-label]="'remove semiconductorPatent'">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>
        <!-- </p> -->
      </div>
    </div>

    <div>
      <mat-tab-group [selectedIndex]="tabIndex" mat-stretch-tabs="false" mat-align-tabs="center"
        style="width: 100%; height: auto">
        <mat-tab>
          <ng-template mat-tab-label>
            <span class="custom-tab-label" style="font-weight: bolder; font-size:16px;">CaseList</span>
          </ng-template>
          <div *ngIf="loader" style="
              display: flex;
              flex-direction: column;
              align-items: flex-start;
              margin-top: 30px;
              height: 140vh;
            ">
            loading litigation cases..
          </div>
          <div class="table-scroll-container" style="overflow-x: scroll; width: 100%; display: block; overflow-y: hidden;">
            <!-- No cases found message -->
            <div
              *ngIf="!loader && tabledata.length === 0"
              style="
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 60vh;
                margin-bottom: 20px;
                font-size: 16px;
                color: #666;
              "
              class="no-results"
            >
              <span>
                {{ searchInputText ? 'No results found for "' + searchInputText + '"' : 'No cases found for the selected filters. Try a different venue or clear filters.' }}
              </span>
            </div>
            <!-- Table -->
             <!-- <div style="border-bottom: 1px solid black;"> -->
            <table
              mat-table
              *ngIf="!loader && tabledata.length > 0"
              [dataSource]="tabledata"
              class="mat-elevation-z8"
              style="
                display: block;
                height: 63.55vh;
                overflow-y: auto;
                overflow-x: scroll;
                margin: 0;
                padding: 0 12px;
                position: relative;
              "
            >
              <!-- Sr. No. Column -->
              <ng-container matColumnDef="srNo">
                <th mat-header-cell *matHeaderCellDef  class="no-wrap sticky-header col-sno brown-header" style="background-color: grey;">Sr. No.</th>
                <td mat-cell *matCellDef="let element; let i = index" class="no-wrap col-sno">
                  {{ (paginator.pageIndex * paginator.pageSize) + i + 1 }}
                </td>
              </ng-container>
              <!-- Case Date Column -->
              <ng-container matColumnDef="caseComplaintDate">
                <th mat-header-cell *matHeaderCellDef class="sticky-header brown-header">Case Date</th>
                <td mat-cell *matCellDef="let element" class="no-wrap">
                  {{ formatDate(convertToDate(element.complaint_date)) }}
                </td>
              </ng-container>
              <!-- Case Number Column -->
              <ng-container matColumnDef="caseNumber">
                <th mat-header-cell *matHeaderCellDef class="sticky-header brown-header">Case Number</th>
                <td mat-cell *matCellDef="let element" class="no-wrap">
                  <a
                    (click)="onSelectCaseNumber(element.case_no); $event.stopPropagation()"
                    style="cursor: pointer; color: blue; font-weight: bolder;"
                    class="no-wrap"
                  >
                    {{ element.case_no || 'NA' }}
                  </a>
                </td>
              </ng-container>
              <!-- Case Name Column -->
              <ng-container matColumnDef="caseName">
                <th mat-header-cell *matHeaderCellDef class="no-text sticky-header brown-header">Case Name</th>
                <td
                  mat-cell
                  *matCellDef="let element"
                  class="wrap-text2"
                  [innerHTML]="element.case_name | caseNameHighlight:6"
                ></td>
              </ng-container>
              <!-- Status Column -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef class="sticky-header col-status brown-header">Status</th>
                <td mat-cell *matCellDef="let element" class="no-wrap col-status">
                  {{ element.case_status || "NA" }}
                </td>
              </ng-container>
              <!-- Court Column -->
              <ng-container matColumnDef="court_name">
                <th mat-header-cell *matHeaderCellDef class="no-text sticky-header brown-header">Court Name</th>
                <td mat-cell *matCellDef="let element" class="wrap-text2">
                  {{ element.court_name || "NA" }}
                </td>
              </ng-container>
              <!-- Venue Column -->
              <ng-container matColumnDef="venue">
                <th mat-header-cell *matHeaderCellDef class="no-wrap sticky-header brown-header">Litigation <br> Venues</th>
                <td mat-cell *matCellDef="let element" class="no-wrap">
                  {{ element.litigation_venues || "NA" }}
                </td>
              </ng-container>
              <!-- Win Prediction Column -->
              <ng-container matColumnDef="winningPrediction">
                <th mat-header-cell *matHeaderCellDef class="no-wrap sticky-header brown-header">Win Prediction</th>
                <td
  mat-cell
  *matCellDef="let element"
  class="win-prediction-cell"
  style="padding: 12px; text-align: center; vertical-align: middle;"
>
  <div
    style="
      width: 50px;
      height: 50px;
      position: relative;
      margin: auto;
    "
  >
    <mat-progress-spinner
      [diameter]="50"
      [mode]="'determinate'"
      [value]="100"
      color="accent"
      style="position: absolute; top: 0; left: 0;"
    ></mat-progress-spinner>

    <mat-progress-spinner
      [diameter]="50"
      [mode]="'determinate'"
      [value]="winningPercentage || 0"
      color="primary"
      style="position: absolute; top: 0; left: 0;"
    ></mat-progress-spinner>

    <span
      style="
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 14px;
        
      "
    >
      {{ (winningPercentage || 0) | number:'1.0-0' }}%
    </span>
  </div>
</td>


              </ng-container>
              <!-- Related Cases Column -->
              <ng-container matColumnDef="relatedCases">
                <th
                  mat-header-cell
                  *matHeaderCellDef
                  style="font-size: 14px; font-weight: bolder; position: sticky; top: 0; background-color: var(--content-bg); z-index: 1;"
                  class="wrap-text2 brown-header"
                >Similar Cases</th>
                <td mat-cell *matCellDef="let element" class="no-wrap">
                  <ng-container *ngIf="element.similar_cases && element.similar_cases.length > 0; else noCases">
                    <!-- Loop through the cases in groups of 2 -->
                    <ng-container *ngFor="let i of getRange(element.similar_cases.length); let idx = index">
                      <ng-container *ngFor="let relatedCase of element.similar_cases.slice(idx * 2, (idx + 1) * 2); let j = index">
                        <a
                          (click)="onSelectCaseNumber(relatedCase.case_no); $event.stopPropagation()"
                          style="cursor: pointer; color: blue;"
                          class="no-wrap"
                          matTooltip="Matched by: {{ relatedCase.match_reasons.join(', ') }}"
                          matTooltipPosition="above"
                        >
                          {{ relatedCase.case_no }}
                        </a>
                        <span *ngIf="j < element.similar_cases.slice(idx * 2, (idx + 1) * 2).length - 1">, </span>
                      </ng-container>
                      <br *ngIf="idx < getRange(element.similar_cases.length).length - 1">
                    </ng-container>
                  </ng-container>
                  <ng-template #noCases>
                    NA
                  </ng-template>
                </td>
              </ng-container>
        
              <!-- Table Header and Row Definitions -->
              <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true" class="sticky-header-row"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
          <!-- </div> -->
          </div>
        
          <mat-paginator [pageSize]="20" showFirstLastButtons [length]="totalCount"></mat-paginator>
        </mat-tab>

        <mat-tab>
          <ng-template mat-tab-label>
            <span class="custom-tab-label" style="font-weight: bolder;font-size:16px;">Analytics</span>
          </ng-template>
          <div>
            <app-analytics 
              [filterDataForAnalytics]="filterDataForAnalytics" 
              [excelData]="excelData2">
            </app-analytics>
          </div>
        </mat-tab>

        <mat-tab>
          <ng-template mat-tab-label>
            <span class="custom-tab-label" style="font-weight: bolder; font-size:16px;">Predictions & Recommendations</span>
          </ng-template>
          <div style="height: 150vh; margin: 20px">
            Coming soon..
          </div>
        </mat-tab>

        <mat-tab>
          <ng-template mat-tab-label>
            <span class="custom-tab-label" style="font-weight: bolder; font-size:16px;">Database</span>
          </ng-template>
          <div style="height: 150vh; margin: 20px">Coming soon..</div>
        </mat-tab>

        <mat-tab>
          <ng-template mat-tab-label>
            <span class="custom-tab-label" style="font-weight: bolder; font-size:16px;">Reports</span>
          </ng-template>
          <div>
            <app-reports></app-reports>
          </div>
          <!-- <div style="height: 150vh; margin: 20px">Coming soon..</div> -->
        </mat-tab>
      </mat-tab-group>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>

